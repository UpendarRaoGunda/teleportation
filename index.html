<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Magical Teleportation Adventure</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
            color: #fff;
            overflow: hidden;
            height: 100vh;
        }

        .game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .location {
            position: absolute;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            display: none;
            transition: all 0.8s ease-in-out;
        }

        .location.active {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            animation: fadeIn 1s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        /* Enhanced Location Backgrounds */
        .great-hall {
            background: 
                radial-gradient(circle at 30% 20%, rgba(255, 215, 0, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 70% 80%, rgba(255, 140, 0, 0.2) 0%, transparent 50%),
                linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), 
                radial-gradient(circle at center, #8B4513, #654321);
        }

        .library {
            background: 
                radial-gradient(circle at 10% 30%, rgba(138, 43, 226, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 90% 70%, rgba(75, 0, 130, 0.2) 0%, transparent 50%),
                linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4)), 
                linear-gradient(45deg, #2F1B14, #8B4513);
        }

        .potions-class {
            background: 
                radial-gradient(circle at 20% 60%, rgba(0, 255, 0, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 0, 255, 0.2) 0%, transparent 50%),
                linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), 
                radial-gradient(circle, #1B5E20, #388E3C);
        }

        .quidditch-field {
            background: 
                radial-gradient(circle at 50% 10%, rgba(255, 215, 0, 0.4) 0%, transparent 30%),
                linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), 
                linear-gradient(to bottom, #87CEEB, #228B22);
        }

        .forbidden-forest {
            background: 
                radial-gradient(circle at 40% 30%, rgba(255, 0, 0, 0.2) 0%, transparent 40%),
                radial-gradient(circle at 60% 70%, rgba(0, 255, 255, 0.15) 0%, transparent 40%),
                linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), 
                radial-gradient(circle, #0D4F0C, #1B5E20);
        }

        .crystal-cave {
            background: 
                radial-gradient(circle at 25% 25%, rgba(0, 191, 255, 0.4) 0%, transparent 50%),
                radial-gradient(circle at 75% 75%, rgba(147, 0, 211, 0.3) 0%, transparent 50%),
                linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), 
                linear-gradient(135deg, #2C3E50, #4A6741);
        }

        .location-info {
            text-align: center;
            background: rgba(0,0,0,0.8);
            padding: 30px;
            border-radius: 20px;
            border: 3px solid #FFD700;
            box-shadow: 0 0 40px rgba(255, 215, 0, 0.6);
            max-width: 700px;
            margin: 20px;
            backdrop-filter: blur(10px);
        }

        .location-title {
            font-size: 2.8em;
            color: #FFD700;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.8);
            margin-bottom: 15px;
            font-weight: bold;
        }

        .location-description {
            font-size: 1.3em;
            line-height: 1.6;
            margin-bottom: 25px;
            color: #E0E0E0;
        }

        .teleport-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
        }

        .teleport-btn {
            background: linear-gradient(45deg, #4A148C, #7B1FA2);
            border: none;
            color: white;
            padding: 12px 25px;
            font-size: 1.1em;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Georgia', serif;
            font-weight: bold;
            border: 2px solid #FFD700;
            box-shadow: 0 4px 15px rgba(123, 31, 162, 0.4);
            touch-action: manipulation;
        }

        .teleport-btn:hover {
            background: linear-gradient(45deg, #6A1B9A, #8E24AA);
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 25px rgba(123, 31, 162, 0.6);
            border-color: #FFF;
        }

        .teleport-btn:active {
            transform: translateY(0) scale(0.98);
        }

        .magic-particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #FFD700;
            border-radius: 50%;
            animation: float 6s infinite linear;
            box-shadow: 0 0 10px #FFD700;
        }

        @keyframes float {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-20px) rotate(360deg);
                opacity: 0;
            }
        }

        .player-profile {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0,0,0,0.85);
            padding: 20px;
            border-radius: 20px;
            border: 3px solid #FFD700;
            min-width: 280px;
            max-width: 90vw;
            backdrop-filter: blur(10px);
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
            overflow-y: auto;
            max-height: 80vh;
        }

        .profile-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin-right: 15px;
            border: 3px solid #FFD700;
            font-size: 2em;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        .player-name {
            font-size: 1.4em;
            color: #FFD700;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 1.1em;
        }

        .stat-label {
            color: #FFD700;
            font-weight: bold;
        }

        .stat-section {
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px solid #FFD700;
            font-size: 0.9em;
        }

        .teleport-effect {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 200px;
            height: 200px;
            border: 4px solid #FFD700;
            border-radius: 50%;
            opacity: 0;
            animation: teleportPulse 1s ease-out;
        }

        @keyframes teleportPulse {
            0% {
                transform: translate(-50%, -50%) scale(0);
                opacity: 1;
                border-width: 8px;
            }
            50% {
                opacity: 0.8;
                border-width: 4px;
            }
            100% {
                transform: translate(-50%, -50%) scale(3);
                opacity: 0;
                border-width: 1px;
            }
        }

        .sound-toggle, .memory-btn {
            position: absolute;
            background: rgba(0,0,0,0.8);
            border: 2px solid #FFD700;
            color: #FFD700;
            padding: 10px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2em;
            width: 50px;
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(10px);
            touch-action: manipulation;
        }

        .sound-toggle {
            top: 20px;
            right: 20px;
        }

        .memory-btn {
            bottom: 20px;
            right: 20px;
        }

        .setup-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .setup-title {
            font-size: 3em;
            color: #FFD700;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.8);
            margin-bottom: 30px;
            text-align: center;
        }

        .setup-form {
            background: rgba(0,0,0,0.8);
            padding: 40px;
            border-radius: 20px;
            border: 3px solid #FFD700;
            box-shadow: 0 0 40px rgba(255, 215, 0, 0.5);
            text-align: center;
            max-width: 500px;
            width: 90%;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            display: block;
            color: #FFD700;
            font-size: 1.2em;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .name-input {
            width: 100%;
            padding: 12px;
            font-size: 1.1em;
            border: 2px solid #FFD700;
            border-radius: 10px;
            background: rgba(255,255,255,0.9);
            color: #333;
            font-family: 'Georgia', serif;
        }

        .avatar-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .avatar-option {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 3px solid #666;
            cursor: pointer;
            font-size: 1.8em;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            touch-action: manipulation;
        }

        .avatar-option:hover {
            transform: scale(1.1);
            border-color: #FFD700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        .avatar-option.selected {
            border-color: #FFD700;
            box-shadow: 0 0 25px rgba(255, 215, 0, 0.8);
            transform: scale(1.15);
        }

        .start-btn {
            background: linear-gradient(45deg, #D32F2F, #F44336);
            border: none;
            color: white;
            padding: 15px 40px;
            font-size: 1.3em;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Georgia', serif;
            font-weight: bold;
            border: 3px solid #FFD700;
            box-shadow: 0 6px 20px rgba(211, 47, 47, 0.4);
            margin-top: 20px;
            touch-action: manipulation;
        }

        .start-btn:hover {
            background: linear-gradient(45deg, #E53935, #FF5722);
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 10px 30px rgba(211, 47, 47, 0.6);
        }

        .location-special-effects {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .floating-books {
            position: absolute;
            font-size: 2em;
            animation: floatBooks 8s infinite ease-in-out;
            opacity: 0.7;
        }

        @keyframes floatBooks {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(10deg); }
        }

        .potion-bubbles {
            position: absolute;
            width: 20px;
            height: 20px;
            background: radial-gradient(circle, #00ff00, #008000);
            border-radius: 50%;
            animation: bubbleUp 4s infinite ease-in-out;
            opacity: 0.8;
        }

        @keyframes bubbleUp {
            0% { transform: translateY(100vh) scale(0); opacity: 0; }
            50% { opacity: 1; transform: scale(1); }
            100% { transform: translateY(-100px) scale(0); opacity: 0; }
        }

        .flying-snitch {
            position: absolute;
            font-size: 1.5em;
            color: #FFD700;
            animation: flySnitch 6s infinite linear;
        }

        @keyframes flySnitch {
            0% { transform: translateX(-100px) translateY(50px); }
            25% { transform: translateX(50vw) translateY(20px); }
            50% { transform: translateX(calc(100vw + 100px)) translateY(80px); }
            75% { transform: translateX(50vw) translateY(60px); }
            100% { transform: translateX(-100px) translateY(50px); }
        }

        .glowing-eyes {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #ff0000;
            border-radius: 50%;
            box-shadow: 0 0 20px #ff0000;
            animation: glowEyes 3s infinite alternate;
        }

        @keyframes glowEyes {
            0% { opacity: 0.3; }
            100% { opacity: 1; }
        }

        .crystal-sparkles {
            position: absolute;
            width: 6px;
            height: 6px;
            background: #00BFFF;
            border-radius: 50%;
            animation: sparkle 2s infinite ease-in-out;
            box-shadow: 0 0 15px #00BFFF;
        }

        @keyframes sparkle {
            0%, 100% { opacity: 0; transform: scale(0); }
            50% { opacity: 1; transform: scale(1); }
        }

        .achievement-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            color: white;
            padding: 20px 30px;
            border-radius: 15px;
            border: 3px solid #FFD700;
            font-size: 1.2em;
            font-weight: bold;
            z-index: 2000;
            animation: achievementPop 3s ease-in-out;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.8);
            text-align: center;
            max-width: 90vw;
        }

        @keyframes achievementPop {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            20% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
            80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
        }

        .weather-effect {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            display: none;
            z-index: 10;
        }

        .rain {
            position: absolute;
            width: 2px;
            height: 20px;
            background: rgba(255,255,255,0.8);
            transform: rotate(20deg);
            animation: rainFall 0.5s linear infinite;
        }

        .snow {
            position: absolute;
            width: 6px;
            height: 6px;
            background: white;
            border-radius: 50%;
            animation: snowFall 6s linear infinite;
        }

        @keyframes rainFall {
            from { transform: translateY(-100vh) rotate(20deg); }
            to { transform: translateY(100vh) rotate(20deg); }
        }

        @keyframes snowFall {
            0% { transform: translateY(-100vh) translateX(0); }
            100% { transform: translateY(100vh) translateX(var(--dx)); }
        }

        @media (max-width: 600px) {
            .location-info {
                padding: 20px;
                margin: 10px;
                max-width: 90vw;
            }

            .location-title {
                font-size: 2em;
            }

            .location-description {
                font-size: 1em;
            }

            .teleport-btn {
                padding: 10px 20px;
                font-size: 1em;
            }

            .player-profile {
                min-width: 200px;
                padding: 15px;
            }

            .avatar {
                width: 50px;
                height: 50px;
                font-size: 1.5em;
            }

            .player-name {
                font-size: 1.2em;
            }

            .setup-form {
                padding: 20px;
            }

            .setup-title {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- Setup Screen -->
        <div class="setup-screen" id="setupScreen">
            <h1 class="setup-title">🏰 Create Your Wizard Profile ✨</h1>
            <div class="setup-form">
                <div class="form-group">
                    <label class="form-label">Enter Your Wizard Name:</label>
                    <input type="text" id="playerName" class="name-input" placeholder="Young Wizard" maxlength="20">
                </div>
                <div class="form-group">
                    <label class="form-label">Choose Your Avatar:</label>
                    <div class="avatar-selection">
                        <div class="avatar-option" data-avatar="🧙‍♂️" onclick="selectAvatar('🧙‍♂️')">🧙‍♂️</div>
                        <div class="avatar-option" data-avatar="🧙‍♀️" onclick="selectAvatar('🧙‍♀️')">🧙‍♀️</div>
                        <div class="avatar-option" data-avatar="🦄" onclick="selectAvatar('🦄')">🦄</div>
                        <div class="avatar-option" data-avatar="🐉" onclick="selectAvatar('🐉')">🐉</div>
                        <div class="avatar-option" data-avatar="🦉" onclick="selectAvatar('🦉')">🦉</div>
                        <div class="avatar-option" data-avatar="🌟" onclick="selectAvatar('🌟')">🌟</div>
                        <div class="avatar-option" data-avatar="⚡" onclick="selectAvatar('⚡')">⚡</div>
                        <div class="avatar-option selected" data-avatar="🔮" onclick="selectAvatar('🔮')">🔮</div>
                    </div>
                </div>
                <button class="start-btn" onclick="startGame()">Begin Your Adventure!</button>
            </div>
        </div>

        <!-- Player Profile -->
        <div class="player-profile" id="playerProfile" style="display: none;">
            <div class="profile-header">
                <div class="avatar" id="playerAvatar">🔮</div>
                <div class="player-name" id="displayName">Young Wizard</div>
            </div>
            <div class="stat-item">
                <span class="stat-label">Teleportations:</span>
                <span id="teleportCount">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Locations Visited:</span>
                <span id="locationCount">1</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Magic Level:</span>
                <span id="magicLevel">Apprentice</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Time of Day:</span>
                <span id="timeDisplay"></span>
            </div>
            <div id="recentHistory" class="stat-section"></div>
            <div id="locationStats" class="stat-section"></div>
            <div id="dailyQuests" class="stat-section"></div>
        </div>

        <!-- Sound Toggle -->
        <button class="sound-toggle" id="soundToggle" onclick="toggleSound()" style="display: none;">🔊</button>

        <!-- Memory Challenge Button -->
        <button class="memory-btn" id="memoryButton" onclick="startMemoryChallenge()" style="display: none;">🧠</button>

        <!-- Weather Effect -->
        <div class="weather-effect" id="weatherEffect"></div>

        <!-- Magic Particles -->
        <div class="magic-particles" id="magicParticles"></div>

        <!-- Great Hall -->
        <div class="location great-hall active" id="great-hall">
            <div class="location-special-effects" id="greatHallEffects"></div>
            <div class="location-info">
                <h2 class="location-title">🏰 The Great Hall</h2>
                <p class="location-description">
                    Welcome to the magnificent Great Hall! The enchanted ceiling shows the sky above, 
                    and floating candles light the long tables where students feast. You can hear the 
                    gentle chatter of fellow wizards and the occasional hoot of an owl.
                </p>
                <div class="teleport-buttons">
                    <button class="teleport-btn" onclick="teleportTo('library')">📚 Library</button>
                    <button class="teleport-btn" onclick="teleportTo('potions-class')">🧪 Potions Class</button>
                    <button class="teleport-btn" onclick="teleportTo('quidditch-field')">🏁 Quidditch Field</button>
                    <button class="teleport-btn" onclick="teleportTo('forbidden-forest')">🌲 Forbidden Forest</button>
                    <button class="teleport-btn" onclick="teleportTo('crystal-cave')">💎 Crystal Cave</button>
                </div>
            </div>
        </div>

        <!-- Library -->
        <div class="location library" id="library">
            <div class="location-special-effects" id="libraryEffects"></div>
            <div class="location-info">
                <h2 class="location-title">📚 The Magical Library</h2>
                <p class="location-description">
                    Towering shelves filled with ancient spellbooks and magical tomes surround you. 
                    The air smells of old parchment and mysterious potions. Some books flutter their 
                    pages when you walk by, eager to share their secrets.
                </p>
                <div class="teleport-buttons">
                    <button class="teleport-btn" onclick="teleportTo('great-hall')">🏰 Great Hall</button>
                    <button class="teleport-btn" onclick="teleportTo('potions-class')">🧪 Potions Class</button>
                    <button class="teleport-btn" onclick="teleportTo('quidditch-field')">🏁 Quidditch Field</button>
                    <button class="teleport-btn" onclick="teleportTo('forbidden-forest')">🌲 Forbidden Forest</button>
                    <button class="teleport-btn" onclick="teleportTo('crystal-cave')">💎 Crystal Cave</button>
                </div>
            </div>
        </div>

        <!-- Potions Class -->
        <div class="location potions-class" id="potions-class">
            <div class="location-special-effects" id="potionsEffects"></div>
            <div class="location-info">
                <h2 class="location-title">🧪 Potions Classroom</h2>
                <p class="location-description">
                    Bubbling cauldrons and mysterious ingredients fill this dimly lit dungeon classroom. 
                    Shelves lined with jars containing pickled creatures and rare herbs create an 
                    atmosphere of magical experimentation.
                </p>
                <div class="teleport-buttons">
                    <button class="teleport-btn" onclick="teleportTo('great-hall')">🏰 Great Hall</button>
                    <button class="teleport-btn" onclick="teleportTo('library')">📚 Library</button>
                    <button class="teleport-btn" onclick="teleportTo('quidditch-field')">🏁 Quidditch Field</button>
                    <button class="teleport-btn" onclick="teleportTo('forbidden-forest')">🌲 Forbidden Forest</button>
                    <button class="teleport-btn" onclick="teleportTo('crystal-cave')">💎 Crystal Cave</button>
                </div>
            </div>
        </div>

        <!-- Quidditch Field -->
        <div class="location quidditch-field" id="quidditch-field">
            <div class="location-special-effects" id="quidditchEffects"></div>
            <div class="location-info">
                <h2 class="location-title">🏁 Quidditch Field</h2>
                <p class="location-description">
                    The vast green field stretches before you with golden goalposts reaching toward 
                    the sky. You can almost hear the cheers of spectators and see the golden snitch 
                    glinting in the sunlight.
                </p>
                <div class="teleport-buttons">
                    <button class="teleport-btn" onclick="teleportTo('great-hall')">🏰 Great Hall</button>
                    <button class="teleport-btn" onclick="teleportTo('library')">📚 Library</button>
                    <button class="teleport-btn" onclick="teleportTo('potions-class')">🧪 Potions Class</button>
                    <button class="teleport-btn" onclick="teleportTo('forbidden-forest')">🌲 Forbidden Forest</button>
                    <button class="teleport-btn" onclick="teleportTo('crystal-cave')">💎 Crystal Cave</button>
                </div>
            </div>
        </div>

        <!-- Forbidden Forest -->
        <div class="location forbidden-forest" id="forbidden-forest">
            <div class="location-special-effects" id="forestEffects"></div>
            <div class="location-info">
                <h2 class="location-title">🌲 The Forbidden Forest</h2>
                <p class="location-description">
                    Dark, ancient trees tower above you, their branches creating a canopy that blocks 
                    most of the sunlight. Strange sounds echo through the forest, and glowing eyes 
                    peer from the shadows.
                </p>
                <div class="teleport-buttons">
                    <button class="teleport-btn" onclick="teleportTo('great-hall')">🏰 Great Hall</button>
                    <button class="teleport-btn" onclick="teleportTo('library')">📚 Library</button>
                    <button class="teleport-btn" onclick="teleportTo('potions-class')">🧪 Potions Class</button>
                    <button class="teleport-btn" onclick="teleportTo('quidditch-field')">🏁 Quidditch Field</button>
                    <button class="teleport-btn" onclick="teleportTo('crystal-cave')">💎 Crystal Cave</button>
                </div>
            </div>
        </div>

        <!-- Crystal Cave -->
        <div class="location crystal-cave" id="crystal-cave">
            <div class="location-special-effects" id="crystalEffects"></div>
            <div class="location-info">
                <h2 class="location-title">💎 The Crystal Cave</h2>
                <p class="location-description">
                    A breathtaking underground cavern filled with luminescent crystals that pulse with 
                    magical energy. The walls shimmer with blues and purples, and the air hums with 
                    ancient magic.
                </p>
                <div class="teleport-buttons">
                    <button class="teleport-btn" onclick="teleportTo('great-hall')">🏰 Great Hall</button>
                    <button class="teleport-btn" onclick="teleportTo('library')">📚 Library</button>
                    <button class="teleport-btn" onclick="teleportTo('potions-class')">🧪 Potions Class</button>
                    <button class="teleport-btn" onclick="teleportTo('quidditch-field')">🏁 Quidditch Field</button>
                    <button class="teleport-btn" onclick="teleportTo('forbidden-forest')">🌲 Forbidden Forest</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentLocation = 'great-hall';
        let teleportCount = 0;
        let visitedLocations = new Set(['great-hall']);
        let soundEnabled = true;
        let selectedAvatar = '🔮';
        let playerName = 'Young Wizard';
        let inMemoryChallenge = false;
        let memorySequence = [];
        let memoryIndex = 0;
        let dailyQuests = [];
        let weatherTimeout = null;

        const locations = {
            'great-hall': 'The Great Hall',
            'library': 'The Magical Library',
            'potions-class': 'Potions Classroom',
            'quidditch-field': 'Quidditch Field',
            'forbidden-forest': 'The Forbidden Forest',
            'crystal-cave': 'The Crystal Cave'
        };

        const achievements = [
            { trigger: 1, message: "🎉 First Teleportation! Magic is in the air!" },
            { trigger: 5, message: "✨ Teleportation Pro! You've teleported 5 times!" },
            { trigger: 10, message: "🚀 Master of Portals! 10 teleports achieved!" },
            { trigger: 15, message: "⚡ Teleportation Champion! 15 magical journeys!" },
            { trigger: 3, message: "🌍 Explorer! You've visited 3 unique locations!" },
            { trigger: 6, message: "🏆 Grand Adventurer! All locations discovered!" },
            { special: 'speed', message: "💨 Speed Wizard! 5 teleports in 30 seconds!" },
            { special: 'night_owl', message: "🦉 Night Owl! Playing after midnight!" },
            { special: 'library_lover', message: "📚 Bookworm! Visited library 5 times!" }
        ];

        let gameStats = {
            sessionStart: Date.now(),
            recentTeleports: [],
            locationVisitCounts: { 'great-hall': 1 },
            lastAchievements: new Set()
        };

        // Audio elements with error handling
        const teleportSound = new Audio('https://www.soundjay.com/buttons/button-09.mp3');
        const backgroundMusic = new Audio('https://www.bensound.com/bensound-music/bensound-slowmotion.mp3');
        backgroundMusic.loop = true;
        backgroundMusic.volume = 0.3;
        teleportSound.onerror = () => console.warn('Teleport sound failed to load');
        backgroundMusic.onerror = () => console.warn('Background music failed to load');

        // Initialize game
        function startGame() {
            const nameInput = document.getElementById('playerName').value.trim();
            if (nameInput) {
                playerName = nameInput;
            }
            document.getElementById('displayName').textContent = playerName;
            document.getElementById('playerAvatar').textContent = selectedAvatar;
            document.getElementById('setupScreen').style.display = 'none';
            document.getElementById('playerProfile').style.display = 'block';
            document.getElementById('soundToggle').style.display = 'flex';
            document.getElementById('memoryButton').style.display = 'flex';
            createMagicParticles();
            createLocationEffects('great-hall');
            if (soundEnabled) {
                try {
                    backgroundMusic.play().catch(err => console.warn('Background music play failed:', err));
                } catch (err) {
                    console.warn('Error playing background music:', err);
                }
            }
            generateDailyQuests();
            updateTimeDisplay();
            setInterval(updateTimeDisplay, 60000);
            updateLocationStats();
            updateQuestsDisplay();
            checkAchievements();
        }

        // Avatar selection
        function selectAvatar(avatar) {
            selectedAvatar = avatar;
            document.querySelectorAll('.avatar-option').forEach(option => {
                option.classList.remove('selected');
            });
            const selectedOption = document.querySelector(`.avatar-option[data-avatar="${avatar}"]`);
            if (selectedOption) {
                selectedOption.classList.add('selected');
            }
        }

        // Teleport to a new location
        function teleportTo(locationId) {
            if (locationId === currentLocation || !locations[locationId]) return;

            // Play teleport effect and sound
            createTeleportEffect();
            if (soundEnabled) {
                try {
                    teleportSound.play().catch(err => console.warn('Teleport sound play failed:', err));
                } catch (err) {
                    console.warn('Error playing teleport sound:', err);
                }
            }

            // Update current location
            document.getElementById(currentLocation).classList.remove('active');
            const newLocation = document.getElementById(locationId);
            if (newLocation) {
                newLocation.classList.add('active');
            } else {
                console.error(`Location ${locationId} not found`);
                return;
            }
            currentLocation = locationId;

            // Update stats
            teleportCount++;
            visitedLocations.add(locationId);
            gameStats.locationVisitCounts[locationId] = (gameStats.locationVisitCounts[locationId] || 0) + 1;
            gameStats.recentTeleports.push({ time: Date.now(), location: locations[locationId] });
            if (gameStats.recentTeleports.length > 5) {
                gameStats.recentTeleports.shift();
            }
            document.getElementById('teleportCount').textContent = teleportCount;
            document.getElementById('locationCount').textContent = visitedLocations.size;

            // Update magic level
            updateMagicLevel();

            // Create location-specific effects
            createLocationEffects(locationId);

            // Check memory challenge
            if (inMemoryChallenge) {
                if (locationId === memorySequence[memoryIndex]) {
                    memoryIndex++;
                    if (memoryIndex === memorySequence.length) {
                        showAchievement("🧠 Memory Master! Sequence completed!");
                        inMemoryChallenge = false;
                        memorySequence = [];
                        memoryIndex = 0;
                    }
                } else {
                    showAchievement("❌ Memory Failed! Try again.");
                    inMemoryChallenge = false;
                    memorySequence = [];
                    memoryIndex = 0;
                }
            }

            // Update displays
            updateHistory();
            updateLocationStats();
            updateQuestsDisplay();

            // Check for achievements
            checkAchievements();

            // Random weather
            if (!weatherTimeout && Math.random() < 0.2) {
                const weathers = ['rain', 'snow'];
                createWeather(weathers[Math.floor(Math.random() * weathers.length)]);
            }
        }

        // Update magic level based on teleport count
        function updateMagicLevel() {
            let level = 'Apprentice';
            if (teleportCount >= 15) {
                level = 'Master Wizard';
            } else if (teleportCount >= 10) {
                level = 'Expert';
            } else if (teleportCount >= 5) {
                level = 'Journeyman';
            } else if (teleportCount >= 2) {
                level = 'Novice';
            }
            document.getElementById('magicLevel').textContent = level;
        }

        // Create magical particles
        function createMagicParticles() {
            const particlesContainer = document.getElementById('magicParticles');
            if (!particlesContainer) return;
            particlesContainer.innerHTML = '';
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.classList.add('particle');
                particle.style.left = `${Math.random() * 100}vw`;
                particle.style.animationDelay = `${Math.random() * 5}s`;
                particlesContainer.appendChild(particle);
            }
        }

        // Create teleport effect
        function createTeleportEffect() {
            const effect = document.createElement('div');
            effect.classList.add('teleport-effect');
            const container = document.querySelector('.game-container');
            if (container) {
                container.appendChild(effect);
                setTimeout(() => effect.remove(), 1000);
            }
        }

        // Create location-specific effects
        function createLocationEffects(locationId) {
            const effectsContainer = document.getElementById(`${locationId}Effects`);
            if (!effectsContainer) return;
            effectsContainer.innerHTML = '';

            switch (locationId) {
                case 'library':
                    for (let i = 0; i < 5; i++) {
                        const book = document.createElement('div');
                        book.classList.add('floating-books');
                        book.textContent = '📖';
                        book.style.left = `${Math.random() * 90 + 5}%`;
                        book.style.top = `${Math.random() * 80 + 10}%`;
                        book.style.animationDelay = `${Math.random() * 4}s`;
                        effectsContainer.appendChild(book);
                    }
                    break;
                case 'potions-class':
                    for (let i = 0; i < 8; i++) {
                        const bubble = document.createElement('div');
                        bubble.classList.add('potion-bubbles');
                        bubble.style.left = `${Math.random() * 90 + 5}%`;
                        bubble.style.animationDelay = `${Math.random() * 3}s`;
                        effectsContainer.appendChild(bubble);
                    }
                    break;
                case 'quidditch-field':
                    const snitch = document.createElement('div');
                    snitch.classList.add('flying-snitch');
                    snitch.textContent = '🏐';
                    snitch.style.animationDelay = `${Math.random() * 2}s`;
                    effectsContainer.appendChild(snitch);
                    break;
                case 'forbidden-forest':
                    for (let i = 0; i < 6; i++) {
                        const eyes = document.createElement('div');
                        eyes.classList.add('glowing-eyes');
                        eyes.style.left = `${Math.random() * 90 + 5}%`;
                        eyes.style.top = `${Math.random() * 80 + 10}%`;
                        eyes.style.animationDelay = `${Math.random() * 2}s`;
                        effectsContainer.appendChild(eyes);
                    }
                    break;
                case 'crystal-cave':
                    for (let i = 0; i < 10; i++) {
                        const sparkle = document.createElement('div');
                        sparkle.classList.add('crystal-sparkles');
                        sparkle.style.left = `${Math.random() * 90 + 5}%`;
                        sparkle.style.top = `${Math.random() * 80 + 10}%`;
                        sparkle.style.animationDelay = `${Math.random() * 1.5}s`;
                        effectsContainer.appendChild(sparkle);
                    }
                    break;
            }
        }

        // Toggle sound
        function toggleSound() {
            soundEnabled = !soundEnabled;
            const soundToggle = document.getElementById('soundToggle');
            if (soundToggle) {
                soundToggle.textContent = soundEnabled ? '🔊' : '🔇';
            }
            if (soundEnabled) {
                try {
                    backgroundMusic.play().catch(err => console.warn('Background music play failed:', err));
                } catch (err) {
                    console.warn('Error playing background music:', err);
                }
            } else {
                backgroundMusic.pause();
            }
        }

        // Check and display achievements
        function checkAchievements() {
            achievements.forEach(ach => {
                if (gameStats.lastAchievements.has(ach.message)) return;

                if (ach.trigger !== undefined) {
                    if ((ach.trigger === teleportCount && [1, 5, 10, 15].includes(ach.trigger)) ||
                        (ach.trigger === visitedLocations.size && [3, 6].includes(ach.trigger))) {
                        showAchievement(ach.message);
                        gameStats.lastAchievements.add(ach.message);
                    }
                } else if (ach.special) {
                    switch (ach.special) {
                        case 'speed':
                            if (gameStats.recentTeleports.length >= 5) {
                                const times = gameStats.recentTeleports.slice(-5).map(t => t.time);
                                if (times[4] - times[0] <= 30000) {
                                    showAchievement(ach.message);
                                    gameStats.lastAchievements.add(ach.message);
                                }
                            }
                            break;
                        case 'night_owl':
                            const hour = new Date().getHours();
                            if (hour >= 0 && hour < 6) {
                                showAchievement(ach.message);
                                gameStats.lastAchievements.add(ach.message);
                            }
                            break;
                        case 'library_lover':
                            if ((gameStats.locationVisitCounts['library'] || 0) >= 5) {
                                showAchievement(ach.message);
                                gameStats.lastAchievements.add(ach.message);
                            }
                            break;
                    }
                }
            });
        }

        // Show achievement popup
        function showAchievement(message) {
            const popup = document.createElement('div');
            popup.classList.add('achievement-popup');
            popup.textContent = message;
            document.body.appendChild(popup);
            setTimeout(() => popup.remove(), 3000);
        }

        // Update time display
        function updateTimeDisplay() {
            const now = new Date();
            const hour = now.getHours();
            let icon = '🌙';
            let tod = 'Night';
            if (hour >= 5 && hour < 9) {
                icon = '🌅';
                tod = 'Dawn';
            } else if (hour >= 9 && hour < 13) {
                icon = '☀️';
                tod = 'Morning';
            } else if (hour >= 13 && hour < 18) {
                icon = '🌞';
                tod = 'Afternoon';
            } else if (hour >= 18 && hour < 21) {
                icon = '🌆';
                tod = 'Evening';
            }
            const timeDisplay = document.getElementById('timeDisplay');
            if (timeDisplay) {
                timeDisplay.innerHTML = `${icon} ${tod}`;
            }
            checkAchievements(); // Check for night_owl achievement
        }

        // Update location history
        function updateHistory() {
            const hist = document.getElementById('recentHistory');
            if (!hist) return;
            hist.innerHTML = '<div class="stat-label">Recent Teleports:</div>' + 
                gameStats.recentTeleports.slice(-5).reverse().map(t => 
                    `<div>${new Date(t.time).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true })} - ${t.location}</div>`
                ).join('');
        }

        // Update location stats
        function updateLocationStats() {
            const ls = document.getElementById('locationStats');
            if (!ls) return;
            ls.innerHTML = '<div class="stat-label">Location Visits:</div>' + 
                Object.entries(gameStats.locationVisitCounts)
                    .sort((a, b) => b[1] - a[1])
                    .map(([loc, count]) => `<div>${locations[loc]}: ${count}</div>`)
                    .join('');
        }

        // Generate daily quests
        function generateDailyQuests() {
            dailyQuests = [
                { type: 'teleport', goal: Math.floor(Math.random() * 5) + 3, desc: (goal) => `Teleport ${goal} times`, completed: false, progress: 0 },
                { type: 'visit_unique', goal: Math.floor(Math.random() * 3) + 2, desc: (goal) => `Visit ${goal} unique locations`, completed: false, progress: 0 },
                { type: 'visit_specific', location: randomLocation(), goal: Math.floor(Math.random() * 3) + 2, completed: false, progress: 0 }
            ].map(q => {
                q.desc = q.type === 'visit_specific' ? `Visit ${locations[q.location]} ${q.goal} times` : q.desc(q.goal);
                return q;
            });
        }

        // Random location helper
        function randomLocation() {
            const keys = Object.keys(locations);
            return keys[Math.floor(Math.random() * keys.length)];
        }

        // Update quests display
        function updateQuestsDisplay() {
            const qd = document.getElementById('dailyQuests');
            if (!qd) return;
            dailyQuests.forEach(q => {
                if (q.type === 'teleport') q.progress = teleportCount;
                else if (q.type === 'visit_unique') q.progress = visitedLocations.size;
                else if (q.type === 'visit_specific') q.progress = gameStats.locationVisitCounts[q.location] || 0;
                if (q.progress >= q.goal && !q.completed) {
                    q.completed = true;
                    showAchievement(`Quest Completed: ${q.desc}! 🎖️`);
                }
            });
            qd.innerHTML = '<div class="stat-label">Daily Quests:</div>' + 
                dailyQuests.map(q => 
                    `<div>${q.desc} (${q.progress}/${q.goal})${q.completed ? ' ✅' : ''}</div>`
                ).join('');
        }

        // Create weather effect
        function createWeather(type) {
            if (weatherTimeout) return;
            const container = document.getElementById('weatherEffect');
            if (!container) return;
            container.innerHTML = '';
            container.style.display = 'block';
            for (let i = 0; i < 50; i++) {
                const drop = document.createElement('div');
                drop.style.position = 'absolute';
                drop.style.left = `${Math.random() * 100}%`;
                drop.style.animationDelay = `${Math.random() * 2}s`;
                drop.style.opacity = Math.random() * 0.5 + 0.3;
                drop.classList.add(type);
                if (type === 'rain') {
                    drop.style.width = '2px';
                    drop.style.height = `${Math.random() * 20 + 10}px`;
                } else if (type === 'snow') {
                    const size = Math.random() * 5 + 3;
                    drop.style.width = `${size}px`;
                    drop.style.height = `${size}px`;
                    drop.style.setProperty('--dx', `${Math.random() * 50 - 25}px`);
                }
                container.appendChild(drop);
            }
            weatherTimeout = setTimeout(() => {
                container.style.display = 'none';
                container.innerHTML = '';
                weatherTimeout = null;
            }, 30000);
        }

        // Start memory challenge
        function startMemoryChallenge() {
            if (inMemoryChallenge) return;
            inMemoryChallenge = true;
            memorySequence = [];
            const availableLocations = Object.keys(locations).filter(loc => loc !== currentLocation);
            for (let i = 0; i < 4; i++) {
                const randomIndex = Math.floor(Math.random() * availableLocations.length);
                memorySequence.push(availableLocations[randomIndex]);
                availableLocations.splice(randomIndex, 1);
            }
            showAchievement(`Memorize this sequence: ${memorySequence.map(l => locations[l]).join(' -> ')}`, 5000);
            memoryIndex = 0;
        }

        // Initialize default avatar selection
        selectAvatar('🔮');

        // Add touch event support
        document.addEventListener('touchstart', function(event) {
            if (event.target.classList.contains('teleport-btn')) {
                event.preventDefault();
                teleportTo(event.target.getAttribute('onclick').match(/'([^']+)'/)[1]);
            } else if (event.target.classList.contains('avatar-option')) {
                selectAvatar(event.target.getAttribute('data-avatar'));
            } else if (event.target.classList.contains('start-btn')) {
                startGame();
            } else if (event.target.classList.contains('sound-toggle')) {
                toggleSound();
            } else if (event.target.classList.contains('memory-btn')) {
                startMemoryChallenge();
            }
        }, { passive: false });
    </script>
</body>
</html>