<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Magical Teleportation Adventure</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
            color: #fff;
            overflow: hidden;
            height: 100vh;
        }

        .game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .location {
            position: absolute;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            display: none;
            transition: all 0.8s ease-in-out;
        }

        .location.active {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            animation: fadeIn 1s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        /* Enhanced Location Backgrounds */
        .great-hall {
            background: 
                radial-gradient(circle at 30% 20%, rgba(255, 215, 0, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 70% 80%, rgba(255, 140, 0, 0.2) 0%, transparent 50%),
                linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), 
                radial-gradient(circle at center, #8B4513, #654321);
        }

        .library {
            background: 
                radial-gradient(circle at 10% 30%, rgba(138, 43, 226, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 90% 70%, rgba(75, 0, 130, 0.2) 0%, transparent 50%),
                linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4)), 
                linear-gradient(45deg, #2F1B14, #8B4513);
        }

        .potions-class {
            background: 
                radial-gradient(circle at 20% 60%, rgba(0, 255, 0, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 0, 255, 0.2) 0%, transparent 50%),
                linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), 
                radial-gradient(circle, #1B5E20, #388E3C);
        }

        .quidditch-field {
            background: 
                radial-gradient(circle at 50% 10%, rgba(255, 215, 0, 0.4) 0%, transparent 30%),
                linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), 
                linear-gradient(to bottom, #87CEEB, #228B22);
        }

        .forbidden-forest {
            background: 
                radial-gradient(circle at 40% 30%, rgba(255, 0, 0, 0.2) 0%, transparent 40%),
                radial-gradient(circle at 60% 70%, rgba(0, 255, 255, 0.15) 0%, transparent 40%),
                linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), 
                radial-gradient(circle, #0D4F0C, #1B5E20);
        }

        .crystal-cave {
            background: 
                radial-gradient(circle at 25% 25%, rgba(0, 191, 255, 0.4) 0%, transparent 50%),
                radial-gradient(circle at 75% 75%, rgba(147, 0, 211, 0.3) 0%, transparent 50%),
                linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), 
                linear-gradient(135deg, #2C3E50, #4A6741);
        }

        .location-info {
            text-align: center;
            background: rgba(0,0,0,0.8);
            padding: 30px;
            border-radius: 20px;
            border: 3px solid #FFD700;
            box-shadow: 0 0 40px rgba(255, 215, 0, 0.6);
            max-width: 700px;
            margin: 20px;
            backdrop-filter: blur(10px);
        }

        .location-title {
            font-size: 2.8em;
            color: #FFD700;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.8);
            margin-bottom: 15px;
            font-weight: bold;
        }

        .location-description {
            font-size: 1.3em;
            line-height: 1.6;
            margin-bottom: 25px;
            color: #E0E0E0;
        }

        .teleport-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
        }

        .teleport-btn {
            background: linear-gradient(45deg, #4A148C, #7B1FA2);
            border: none;
            color: white;
            padding: 12px 25px;
            font-size: 1.1em;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Georgia', serif;
            font-weight: bold;
            border: 2px solid #FFD700;
            box-shadow: 0 4px 15px rgba(123, 31, 162, 0.4);
        }

        .teleport-btn:hover {
            background: linear-gradient(45deg, #6A1B9A, #8E24AA);
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 25px rgba(123, 31, 162, 0.6);
            border-color: #FFF;
        }

        .teleport-btn:active {
            transform: translateY(0) scale(0.98);
        }

        .magic-particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #FFD700;
            border-radius: 50%;
            animation: float 6s infinite linear;
            box-shadow: 0 0 10px #FFD700;
        }

        @keyframes float {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-20px) rotate(360deg);
                opacity: 0;
            }
        }

        .player-profile {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0,0,0,0.85);
            padding: 20px;
            border-radius: 20px;
            border: 3px solid #FFD700;
            min-width: 280px;
            backdrop-filter: blur(10px);
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
        }

        .profile-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin-right: 15px;
            border: 3px solid #FFD700;
            font-size: 2em;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        .player-name {
            font-size: 1.4em;
            color: #FFD700;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 1.1em;
        }

        .stat-label {
            color: #FFD700;
            font-weight: bold;
        }

        .teleport-effect {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 200px;
            height: 200px;
            border: 4px solid #FFD700;
            border-radius: 50%;
            opacity: 0;
            animation: teleportPulse 1s ease-out;
        }

        @keyframes teleportPulse {
            0% {
                transform: translate(-50%, -50%) scale(0);
                opacity: 1;
                border-width: 8px;
            }
            50% {
                opacity: 0.8;
                border-width: 4px;
            }
            100% {
                transform: translate(-50%, -50%) scale(3);
                opacity: 0;
                border-width: 1px;
            }
        }

        .sound-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            border: 2px solid #FFD700;
            color: #FFD700;
            padding: 10px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2em;
            width: 50px;
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(10px);
        }

        .setup-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .setup-title {
            font-size: 3em;
            color: #FFD700;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.8);
            margin-bottom: 30px;
            text-align: center;
        }

        .setup-form {
            background: rgba(0,0,0,0.8);
            padding: 40px;
            border-radius: 20px;
            border: 3px solid #FFD700;
            box-shadow: 0 0 40px rgba(255, 215, 0, 0.5);
            text-align: center;
            max-width: 500px;
            width: 90%;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            display: block;
            color: #FFD700;
            font-size: 1.2em;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .name-input {
            width: 100%;
            padding: 12px;
            font-size: 1.1em;
            border: 2px solid #FFD700;
            border-radius: 10px;
            background: rgba(255,255,255,0.9);
            color: #333;
            font-family: 'Georgia', serif;
        }

        .avatar-selection {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .avatar-option {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 3px solid #666;
            cursor: pointer;
            font-size: 1.8em;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
        }

        .avatar-option:hover {
            transform: scale(1.1);
            border-color: #FFD700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        .avatar-option.selected {
            border-color: #FFD700;
            box-shadow: 0 0 25px rgba(255, 215, 0, 0.8);
            transform: scale(1.15);
        }

        .start-btn {
            background: linear-gradient(45deg, #D32F2F, #F44336);
            border: none;
            color: white;
            padding: 15px 40px;
            font-size: 1.3em;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Georgia', serif;
            font-weight: bold;
            border: 3px solid #FFD700;
            box-shadow: 0 6px 20px rgba(211, 47, 47, 0.4);
            margin-top: 20px;
        }

        .start-btn:hover {
            background: linear-gradient(45deg, #E53935, #FF5722);
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 10px 30px rgba(211, 47, 47, 0.6);
        }

        .location-special-effects {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .floating-books {
            position: absolute;
            font-size: 2em;
            animation: floatBooks 8s infinite ease-in-out;
            opacity: 0.7;
        }

        @keyframes floatBooks {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(10deg); }
        }

        .potion-bubbles {
            position: absolute;
            width: 20px;
            height: 20px;
            background: radial-gradient(circle, #00ff00, #008000);
            border-radius: 50%;
            animation: bubbleUp 4s infinite ease-in-out;
            opacity: 0.8;
        }

        @keyframes bubbleUp {
            0% { transform: translateY(100vh) scale(0); opacity: 0; }
            50% { opacity: 1; transform: scale(1); }
            100% { transform: translateY(-100px) scale(0); opacity: 0; }
        }

        .flying-snitch {
            position: absolute;
            font-size: 1.5em;
            color: #FFD700;
            animation: flySnitch 6s infinite linear;
        }

        @keyframes flySnitch {
            0% { transform: translateX(-100px) translateY(50px); }
            25% { transform: translateX(50vw) translateY(20px); }
            50% { transform: translateX(calc(100vw + 100px)) translateY(80px); }
            75% { transform: translateX(50vw) translateY(60px); }
            100% { transform: translateX(-100px) translateY(50px); }
        }

        .glowing-eyes {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #ff0000;
            border-radius: 50%;
            box-shadow: 0 0 20px #ff0000;
            animation: glowEyes 3s infinite alternate;
        }

        @keyframes glowEyes {
            0% { opacity: 0.3; }
            100% { opacity: 1; }
        }

        .crystal-sparkles {
            position: absolute;
            width: 6px;
            height: 6px;
            background: #00BFFF;
            border-radius: 50%;
            animation: sparkle 2s infinite ease-in-out;
            box-shadow: 0 0 15px #00BFFF;
        }

        @keyframes sparkle {
            0%, 100% { opacity: 0; transform: scale(0); }
            50% { opacity: 1; transform: scale(1); }
        }

        .achievement-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            color: white;
            padding: 20px 30px;
            border-radius: 15px;
            border: 3px solid #FFD700;
            font-size: 1.2em;
            font-weight: bold;
            z-index: 2000;
            animation: achievementPop 3s ease-in-out;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.8);
        }

        @keyframes achievementPop {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            20% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
            80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- Setup Screen -->
        <div class="setup-screen" id="setupScreen">
            <h1 class="setup-title">üè∞ Create Your Wizard Profile ‚ú®</h1>
            <div class="setup-form">
                <div class="form-group">
                    <label class="form-label">Enter Your Wizard Name:</label>
                    <input type="text" id="playerName" class="name-input" placeholder="Young Wizard" maxlength="20">
                </div>
                <div class="form-group">
                    <label class="form-label">Choose Your Avatar:</label>
                    <div class="avatar-selection">
                        <div class="avatar-option" data-avatar="üßô‚Äç‚ôÇÔ∏è" onclick="selectAvatar('üßô‚Äç‚ôÇÔ∏è')">üßô‚Äç‚ôÇÔ∏è</div>
                        <div class="avatar-option" data-avatar="üßô‚Äç‚ôÄÔ∏è" onclick="selectAvatar('üßô‚Äç‚ôÄÔ∏è')">üßô‚Äç‚ôÄÔ∏è</div>
                        <div class="avatar-option" data-avatar="ü¶Ñ" onclick="selectAvatar('ü¶Ñ')">ü¶Ñ</div>
                        <div class="avatar-option" data-avatar="üêâ" onclick="selectAvatar('üêâ')">üêâ</div>
                        <div class="avatar-option" data-avatar="ü¶â" onclick="selectAvatar('ü¶â')">ü¶â</div>
                        <div class="avatar-option" data-avatar="üåü" onclick="selectAvatar('üåü')">üåü</div>
                        <div class="avatar-option" data-avatar="‚ö°" onclick="selectAvatar('‚ö°')">‚ö°</div>
                        <div class="avatar-option selected" data-avatar="üîÆ" onclick="selectAvatar('üîÆ')">üîÆ</div>
                    </div>
                </div>
                <button class="start-btn" onclick="startGame()">Begin Your Adventure!</button>
            </div>
        </div>

        <!-- Player Profile -->
        <div class="player-profile" id="playerProfile" style="display: none;">
            <div class="profile-header">
                <div class="avatar" id="playerAvatar">üîÆ</div>
                <div class="player-name" id="displayName">Young Wizard</div>
            </div>
            <div class="stat-item">
                <span class="stat-label">Teleportations:</span>
                <span id="teleportCount">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Locations Visited:</span>
                <span id="locationCount">1</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Magic Level:</span>
                <span id="magicLevel">Apprentice</span>
            </div>
        </div>

        <!-- Sound Toggle -->
        <button class="sound-toggle" id="soundToggle" onclick="toggleSound()" style="display: none;">üîä</button>

        <!-- Magic Particles -->
        <div class="magic-particles" id="magicParticles"></div>

        <!-- Great Hall -->
        <div class="location great-hall active" id="great-hall">
            <div class="location-special-effects" id="greatHallEffects"></div>
            <div class="location-info">
                <h2 class="location-title">üè∞ The Great Hall</h2>
                <p class="location-description">
                    Welcome to the magnificent Great Hall! The enchanted ceiling shows the sky above, 
                    and floating candles light the long tables where students feast. You can hear the 
                    gentle chatter of fellow wizards and the occasional hoot of an owl.
                </p>
                <div class="teleport-buttons">
                    <button class="teleport-btn" onclick="teleportTo('library')">üìö Library</button>
                    <button class="teleport-btn" onclick="teleportTo('potions-class')">üß™ Potions Class</button>
                    <button class="teleport-btn" onclick="teleportTo('quidditch-field')">üèÅ Quidditch Field</button>
                    <button class="teleport-btn" onclick="teleportTo('forbidden-forest')">üå≤ Forbidden Forest</button>
                    <button class="teleport-btn" onclick="teleportTo('crystal-cave')">üíé Crystal Cave</button>
                </div>
            </div>
        </div>

        <!-- Library -->
        <div class="location library" id="library">
            <div class="location-special-effects" id="libraryEffects"></div>
            <div class="location-info">
                <h2 class="location-title">üìö The Magical Library</h2>
                <p class="location-description">
                    Towering shelves filled with ancient spellbooks and magical tomes surround you. 
                    The air smells of old parchment and mysterious potions. Some books flutter their 
                    pages when you walk by, eager to share their secrets. Floating books drift lazily through the air.
                </p>
                <div class="teleport-buttons">
                    <button class="teleport-btn" onclick="teleportTo('great-hall')">üè∞ Great Hall</button>
                    <button class="teleport-btn" onclick="teleportTo('potions-class')">üß™ Potions Class</button>
                    <button class="teleport-btn" onclick="teleportTo('quidditch-field')">üèÅ Quidditch Field</button>
                    <button class="teleport-btn" onclick="teleportTo('forbidden-forest')">üå≤ Forbidden Forest</button>
                    <button class="teleport-btn" onclick="teleportTo('crystal-cave')">üíé Crystal Cave</button>
                </div>
            </div>
        </div>

        <!-- Potions Class -->
        <div class="location potions-class" id="potions-class">
            <div class="location-special-effects" id="potionsEffects"></div>
            <div class="location-info">
                <h2 class="location-title">üß™ Potions Classroom</h2>
                <p class="location-description">
                    Bubbling cauldrons and mysterious ingredients fill this dimly lit dungeon classroom. 
                    Shelves lined with jars containing pickled creatures and rare herbs create an 
                    atmosphere of magical experimentation. The air shimmers with potion vapors and glowing bubbles.
                </p>
                <div class="teleport-buttons">
                    <button class="teleport-btn" onclick="teleportTo('great-hall')">üè∞ Great Hall</button>
                    <button class="teleport-btn" onclick="teleportTo('library')">üìö Library</button>
                    <button class="teleport-btn" onclick="teleportTo('quidditch-field')">üèÅ Quidditch Field</button>
                    <button class="teleport-btn" onclick="teleportTo('forbidden-forest')">üå≤ Forbidden Forest</button>
                    <button class="teleport-btn" onclick="teleportTo('crystal-cave')">üíé Crystal Cave</button>
                </div>
            </div>
        </div>

        <!-- Quidditch Field -->
        <div class="location quidditch-field" id="quidditch-field">
            <div class="location-special-effects" id="quidditchEffects"></div>
            <div class="location-info">
                <h2 class="location-title">üèÅ Quidditch Field</h2>
                <p class="location-description">
                    The vast green field stretches before you with golden goalposts reaching toward 
                    the sky. You can almost hear the cheers of spectators and see the golden snitch 
                    glinting in the sunlight. Broomsticks zoom overhead in practice flights.
                </p>
                <div class="teleport-buttons">
                    <button class="teleport-btn" onclick="teleportTo('great-hall')">üè∞ Great Hall</button>
                    <button class="teleport-btn" onclick="teleportTo('library')">üìö Library</button>
                    <button class="teleport-btn" onclick="teleportTo('potions-class')">üß™ Potions Class</button>
                    <button class="teleport-btn" onclick="teleportTo('forbidden-forest')">üå≤ Forbidden Forest</button>
                    <button class="teleport-btn" onclick="teleportTo('crystal-cave')">üíé Crystal Cave</button>
                </div>
            </div>
        </div>

        <!-- Forbidden Forest -->
        <div class="location forbidden-forest" id="forbidden-forest">
            <div class="location-special-effects" id="forestEffects"></div>
            <div class="location-info">
                <h2 class="location-title">üå≤ The Forbidden Forest</h2>
                <p class="location-description">
                    Dark, ancient trees tower above you, their branches creating a canopy that blocks 
                    most of the sunlight. Strange sounds echo through the forest, and glowing eyes 
                    peer from the shadows. This magical place is full of mystery and wonder.
                </p>
                <div class="teleport-buttons">
                    <button class="teleport-btn" onclick="teleportTo('great-hall')">üè∞ Great Hall</button>
                    <button class="teleport-btn" onclick="teleportTo('library')">üìö Library</button>
                    <button class="teleport-btn" onclick="teleportTo('potions-class')">üß™ Potions Class</button>
                    <button class="teleport-btn" onclick="teleportTo('quidditch-field')">üèÅ Quidditch Field</button>
                    <button class="teleport-btn" onclick="teleportTo('crystal-cave')">üíé Crystal Cave</button>
                </div>
            </div>
        </div>

        <!-- Crystal Cave -->
        <div class="location crystal-cave" id="crystal-cave">
            <div class="location-special-effects" id="crystalEffects"></div>
            <div class="location-info">
                <h2 class="location-title">üíé The Crystal Cave</h2>
                <p class="location-description">
                    A breathtaking underground cavern filled with luminescent crystals that pulse with 
                    magical energy. The walls shimmer with blues and purples, and the air hums with 
                    ancient magic. This is where the most powerful spells are born from crystal energy.
                </p>
                <div class="teleport-buttons">
                    <button class="teleport-btn" onclick="teleportTo('great-hall')">üè∞ Great Hall</button>
                    <button class="teleport-btn" onclick="teleportTo('library')">üìö Library</button>
                    <button class="teleport-btn" onclick="teleportTo('potions-class')">üß™ Potions Class</button>
                    <button class="teleport-btn" onclick="teleportTo('quidditch-field')">üèÅ Quidditch Field</button>
                    <button class="teleport-btn" onclick="teleportTo('forbidden-forest')">üå≤ Forbidden Forest</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentLocation = 'great-hall';
        let teleportCount = 0;
        let visitedLocations = new Set(['great-hall']);
        let soundEnabled = true;
        let selectedAvatar = 'üîÆ';
        let playerName = 'Young Wizard';

        const locations = {
            'great-hall': 'The Great Hall',
            'library': 'The Magical Library',
            'potions-class': 'Potions Classroom',
            'quidditch-field': 'Quidditch Field',
            'forbidden-forest': 'The Forbidden Forest',
            'crystal-cave': 'The Crystal Cave'
        };

        const achievements = [
            { trigger: 1, message: "üéâ First Teleportation! Magic is in the air!" },
            { trigger: 5, message: "‚ú® Teleportation Pro! You've teleported 5 times!" },
            { trigger: 10, message: "üöÄ Master of Portals! 10 teleports achieved!" },
            { trigger: 3, message: "üåç Explorer! You've visited 3 unique locations!" },
            { trigger: 6, message: "üèÜ Grand Adventurer! All locations discovered!" }
        ];

        // Audio elements for teleport and background sounds
        const teleportSound = new Audio('https://www.soundjay.com/buttons/button-09.mp3');
        const backgroundMusic = new Audio('https://www.bensound.com/bensound-music/bensound-slowmotion.mp3');
        backgroundMusic.loop = true;
        backgroundMusic.volume = 0.3;

        // Initialize game
        function startGame() {
            const nameInput = document.getElementById('playerName').value.trim();
            if (nameInput) {
                playerName = nameInput;
            }
            document.getElementById('displayName').textContent = playerName;
            document.getElementById('playerAvatar').textContent = selectedAvatar;
            document.getElementById('setupScreen').style.display = 'none';
            document.getElementById('playerProfile').style.display = 'block';
            document.getElementById('soundToggle').style.display = 'flex';
            createMagicParticles();
            createLocationEffects('great-hall');
            if (soundEnabled) {
                backgroundMusic.play();
            }
        }

        // Avatar selection
        function selectAvatar(avatar) {
            selectedAvatar = avatar;
            document.querySelectorAll('.avatar-option').forEach(option => {
                option.classList.remove('selected');
            });
            const selectedOption = document.querySelector(`.avatar-option[data-avatar="${avatar}"]`);
            selectedOption.classList.add('selected');
        }

        // Teleport to a new location
        function teleportTo(locationId) {
            if (locationId === currentLocation) return;

            // Play teleport effect and sound
            createTeleportEffect();
            if (soundEnabled) {
                teleportSound.play();
            }

            // Update current location
            document.getElementById(currentLocation).classList.remove('active');
            document.getElementById(locationId).classList.add('active');
            currentLocation = locationId;

            // Update stats
            teleportCount++;
            visitedLocations.add(locationId);
            document.getElementById('teleportCount').textContent = teleportCount;
            document.getElementById('locationCount').textContent = visitedLocations.size;

            // Update magic level
            updateMagicLevel();

            // Create location-specific effects
            createLocationEffects(locationId);

            // Check for achievements
            checkAchievements();
        }

        // Update magic level based on teleport count
        function updateMagicLevel() {
            let level = 'Apprentice';
            if (teleportCount >= 10) {
                level = 'Master Wizard';
            } else if (teleportCount >= 5) {
                level = 'Journeyman';
            } else if (teleportCount >= 2) {
                level = 'Novice';
            }
            document.getElementById('magicLevel').textContent = level;
        }

        // Create magical particles
        function createMagicParticles() {
            const particlesContainer = document.getElementById('magicParticles');
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.classList.add('particle');
                particle.style.left = `${Math.random() * 100}vw`;
                particle.style.animationDelay = `${Math.random() * 5}s`;
                particlesContainer.appendChild(particle);
            }
        }

        // Create teleport effect
        function createTeleportEffect() {
            const effect = document.createElement('div');
            effect.classList.add('teleport-effect');
            document.querySelector('.game-container').appendChild(effect);
            setTimeout(() => effect.remove(), 1000);
        }

        // Create location-specific effects
        function createLocationEffects(locationId) {
            const effectsContainer = document.getElementById(`${locationId}Effects`);
            effectsContainer.innerHTML = ''; // Clear previous effects

            switch (locationId) {
                case 'library':
                    for (let i = 0; i < 5; i++) {
                        const book = document.createElement('div');
                        book.classList.add('floating-books');
                        book.textContent = 'üìñ';
                        book.style.left = `${Math.random() * 90 + 5}%`;
                        book.style.top = `${Math.random() * 80 + 10}%`;
                        book.style.animationDelay = `${Math.random() * 4}s`;
                        effectsContainer.appendChild(book);
                    }
                    break;
                case 'potions-class':
                    for (let i = 0; i < 8; i++) {
                        const bubble = document.createElement('div');
                        bubble.classList.add('potion-bubbles');
                        bubble.style.left = `${Math.random() * 90 + 5}%`;
                        bubble.style.animationDelay = `${Math.random() * 3}s`;
                        effectsContainer.appendChild(bubble);
                    }
                    break;
                case 'quidditch-field':
                    const snitch = document.createElement('div');
                    snitch.classList.add('flying-snitch');
                    snitch.textContent = 'üèê';
                    snitch.style.animationDelay = `${Math.random() * 2}s`;
                    effectsContainer.appendChild(snitch);
                    break;
                case 'forbidden-forest':
                    for (let i = 0; i < 6; i++) {
                        const eyes = document.createElement('div');
                        eyes.classList.add('glowing-eyes');
                        eyes.style.left = `${Math.random() * 90 + 5}%`;
                        eyes.style.top = `${Math.random() * 80 + 10}%`;
                        eyes.style.animationDelay = `${Math.random() * 2}s`;
                        effectsContainer.appendChild(eyes);
                    }
                    break;
                case 'crystal-cave':
                    for (let i = 0; i < 10; i++) {
                        const sparkle = document.createElement('div');
                        sparkle.classList.add('crystal-sparkles');
                        sparkle.style.left = `${Math.random() * 90 + 5}%`;
                        sparkle.style.top = `${Math.random() * 80 + 10}%`;
                        sparkle.style.animationDelay = `${Math.random() * 1.5}s`;
                        effectsContainer.appendChild(sparkle);
                    }
                    break;
                default:
                    // No specific effects for Great Hall
                    break;
            }
        }

        // Toggle sound
        function toggleSound() {
            soundEnabled = !soundEnabled;
            document.getElementById('soundToggle').textContent = soundEnabled ? 'üîä' : 'üîá';
            if (soundEnabled) {
                backgroundMusic.play();
            } else {
                backgroundMusic.pause();
            }
        }

        // Check and display achievements
        function checkAchievements() {
            achievements.forEach(achievement => {
                if (
                    (achievement.trigger === teleportCount && teleportCount <= 10) ||
                    (achievement.trigger === visitedLocations.size && visitedLocations.size <= 6)
                ) {
                    showAchievement(achievement.message);
                }
            });
        }

        // Show achievement popup
        function showAchievement(message) {
            const popup = document.createElement('div');
            popup.classList.add('achievement-popup');
            popup.textContent = message;
            document.body.appendChild(popup);
            setTimeout(() => popup.remove(), 3000);
        }

        // Initialize default avatar selection
        selectAvatar('üîÆ');
    </script>
</body>
</html>